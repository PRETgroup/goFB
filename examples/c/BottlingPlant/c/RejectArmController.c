// This file has been automatically generated by go-iec61499 and should not be edited by hand
// Converter written by Hammond Pearce and available at github.com/kiwih/go-iec61499

// This file represents the implementation of the Basic Function Block for RejectArmController
#include "RejectArmController.h"

enum RejectArmController_states { STATE_Clear, STATE_AwaitCanister, STATE_GoReject };

/* RejectArmController_init() is required to be called to 
 * initialise an instance of RejectArmController. 
 * It sets all I/O values to zero.
 */
void RejectArmController_init(struct RejectArmController *me) {
	//if there are input events, reset them
	me->inputEvents.events[0] = 0;
	
	//if there are output events, reset them
	me->outputEvents.events[0] = 0;
	
	//if there are input vars, reset them
	me->RejectSiteLaser = 0;
	
	//if there are output vars, reset them
	
	//if there are internal vars, reset them
	
}

/* RejectArmController_run() executes a single tick of an
 * instance of RejectArmController according to synchronous semantics.
 * Notice that it does NOT perform any I/O - synchronisation
 * will need to be done in the parent.
 */
void RejectArmController_run(struct RejectArmController *me) {
	//current state storage
	static enum RejectArmController_states state = STATE_Clear;
	static BOOL trigger = false;

	//if there are output events, reset them
	me->outputEvents.events[0] = 0;
	
	//now, let's advance state
	switch(state) {
	case STATE_Clear:
		if(me->inputEvents.event.RejectCanister) {
			state = STATE_AwaitCanister;
			trigger = true;
		};
		break;

	case STATE_AwaitCanister:
		if(me->inputEvents.event.LasersChanged AND (me->inputVars.RejectSiteLaser)) {
			state = STATE_GoReject;
			trigger = true;
		};
		break;

	case STATE_GoReject:
		if(me->inputEvents.event.RejectCanister) {
			state = STATE_AwaitCanister;
			trigger = true;
		};
		break;

	
	}

	//now, let's run any algorithms and emit any events that need to occur due to the trigger
	if(trigger == true) {
		switch(state) {
		case STATE_Clear:
			break;

		case STATE_AwaitCanister:
			break;

		case STATE_GoReject:
			me->outputEvents.event.GoRejectArm = 1;
			break;

		
		}
	}
}

//no algorithms were present for this function block


