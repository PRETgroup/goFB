// This file has been automatically generated by go-iec61499 and should not be edited by hand
// Converter written by Hammond Pearce and available at github.com/kiwih/go-iec61499

// This file represents the implementation of the Basic Function Block for InjectorMotorController
#include "InjectorMotorController.h"

enum InjectorMotorController_states { STATE_MoveArmUp, STATE_Await_Bottle, STATE_MoveArmDown, STATE_Await_Pumping }

void InjectorMotorController_init(struct InjectorMotorController *me) {
	//if there are output events, reset them
	me->outputEvents.StartPump[0] = 0;
	me->outputEvents->StartPump[1] = 0;
	me->outputEvents.InjectDone[0] = 0;
	me->outputEvents->InjectDone[1] = 0;
	me->outputEvents.InjectorPositionChanged[0] = 0;
	me->outputEvents->InjectorPositionChanged[1] = 0;
	me->outputEvents.InjectRunning[0] = 0;
	me->outputEvents->InjectRunning[1] = 0;
	
	//if there are output vars, reset them
	me->outputVars.InjectorPosition = 0;
	
	//if there are internal vars, reset them
	
}

void InjectorMotorController_run(struct InjectorMotorController *me) {
	//current state storage
	static enum InjectorMotorController_states state = STATE_MoveArmUp;

	//now, let's advance state
	switch(state) {
	case STATE_MoveArmUp :
		if(me->inputEvents.InjectorArmFinishedMovement) {
			state = STATE_Await_Bottle;
		};
	case STATE_Await_Bottle :
		if(me->inputEvents.ConveyorStoppedForInject) {
			state = STATE_MoveArmDown;
		};
	case STATE_MoveArmDown :
		if(me->inputEvents.InjectorArmFinishedMovement) {
			state = STATE_Await_Pumping;
		};
	case STATE_Await_Pumping :
		if(me->inputEvents.PumpFinished) {
			state = STATE_MoveArmUp;
		};
	
	}
}

//algorithms

void InjectorMotorController_SetArmDownPosition(struct InjectorMotorController *me) {
InjectorPosition <= x"FF";
DONE <= '1';
}

void InjectorMotorController_SetArmUpPosition(struct InjectorMotorController *me) {
InjectorPosition <= x"00";
DONE <= '1';
}

void InjectorMotorController_Algorithm1(struct InjectorMotorController *me) {
DONE <= '1';
}



