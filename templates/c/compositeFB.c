{{define "compositeFB"}}// This file has been automatically generated by go-iec61499 and should not be edited by hand
// Converter written by Hammond Pearce and available at github.com/kiwih/go-iec61499
{{$block := index .Blocks .BlockIndex}}{{$blocks := .Blocks}}{{$compositeFB := $block.CompositeFB}}
// This file represents the implementation of the Composite Function Block for {{$block.Name}}
#include "{{$block.Name}}.h"

/* {{$block.Name}}_init() is required to be called to 
 * initialise an instance of {{$block.Name}}. 
 * As this is a composite function block, it contains no values of its own,
 * and so merely calls the initialisation routines of its children.
 */
void {{$block.Name}}_init(struct {{$block.Name}} *me) {
	{{range $currChildIndex, $child := $block.CompositeFB.FBs}}{{$child.Type}}_init(&me->{{$child.Name}});
	{{end}}
}

/* {{$block.Name}}_sync() synchronises an
 * instance of {{$block.Name}} according to synchronise semantics.
 * Notice that it does NOT perform any computation - additional steps
 * will need to be done at the parent.
 */
void {{$block.Name}}_sync(struct {{$block.Name}} *me) {
	//for all composite function block children, call this same function
	//for all basic function block children, perform their synchronisations explicitly
	{{range $currChildIndex, $child := $compositeFB.FBs}}{{$childType := findBlockDefinitionForType $blocks $child.Type}}
	{{if $childType.CompositeFB}}//sync for {{$child.Name}} (of type {{$childType.Name}}) which is a CFB
	{{$childType}}_sync(&me->{{$child.Name}});
	{{else}}//sync for {{$child.Name}} (of type {{$childType.Name}}) which is a BFB
	{{if $childType.EventInputs}}{{range $index, $event := $childType.EventInputs.Events}}me->{{$child.Name}}.InputEvents.event.{{$event.Name}} = ?;
	{{end}}{{end}}{{end}}{{end}}
}


/* {{$block.Name}}_run() executes a single tick of an
 * instance of {{$block.Name}} according to synchronise semantics.
 * Notice that it does NOT perform any I/O - additional synchronisation
 * will need to be done at the parent.
 */
void {{$block.Name}}_run(struct {{$block.Name}} *me) {
	{{range $currChildIndex, $child := $block.CompositeFB.FBs}}{{$child.Type}}_run(&me->{{$child.Name}});
	{{end}}
}

{{end}}