
--This is an autogenerated file
--Do not modify it by hand
--Generated at 2017-12-08T14:25:09+13:00
library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;
use work.enforcement_types_AlphabetEnforcer.all;

entity enforcer_AlphabetEnforcer_P2 is
    port
    (
        clk         : in std_logic;
        reset       : in std_logic;
        t           : in unsigned(63 downto 0); --current time in nanoseconds
        e           : out std_logic;            --if enforcement occured

        --the input signals
        
        --the enforce signals
        q           : in enforced_signals_AlphabetEnforcer;
        q_prime     : out enforced_signals_AlphabetEnforcer
    );
end entity;

architecture behaviour of enforcer_AlphabetEnforcer_P2 is
    signal trigger_tL1 : std_logic := '0';
    signal trigger_tL1_time : unsigned(63 downto 0) := (others => '0');
    signal trigger_tL2 : std_logic := '0';
    signal trigger_tL2_time : unsigned(63 downto 0) := (others => '0');
    
begin
    
    --trigger process
    process(reset, clk, q, t)
    variable q_enf: enforced_signals_AlphabetEnforcer;
    
    begin
        if(rising_edge(clk)) then
            --default values
            
            q_enf := q;
            e <= '0';

            --policies begin
            
            if((trigger_tL1 = '1') and not((q_enf.L = '0')) and (t < (to_unsigned(500000000, 64) + trigger_tL1_time)) ) then
                e <= '1';
                --recover
                q_enf.L := '0';
                
            end if;
            
            if((trigger_tL1 = '1') and not((q_enf.L = '1')) and (t > (to_unsigned(600000000, 64) + trigger_tL1_time)) ) then
                e <= '1';
                --recover
                q_enf.L := '1';
                
            end if;
            
            if((trigger_tL2 = '1') and not((q_enf.L = '1')) and (t < (to_unsigned(500000000, 64) + trigger_tL2_time)) ) then
                e <= '1';
                --recover
                q_enf.L := '1';
                
            end if;
            
            if((trigger_tL2 = '1') and not((q_enf.L = '0')) and (t > (to_unsigned(600000000, 64) + trigger_tL2_time)) ) then
                e <= '1';
                --recover
                q_enf.L := '0';
                
            end if;
            

            --Triggers begin (triggers are after policies because a policy might edit a value that a trigger depends on)
            
            if(trigger_tL1 = '0' and ((q_enf.L = '0'))) then
                trigger_tL1 <= '1';
                trigger_tL1_time <= t;
            end if;
            if(trigger_tL1 = '1' and ((q_enf.L = '1'))) then
                trigger_tL1 <= '0';
            end if;
            
            if(trigger_tL2 = '0' and ((q_enf.L = '1'))) then
                trigger_tL2 <= '1';
                trigger_tL2_time <= t;
            end if;
            if(trigger_tL2 = '1' and ((q_enf.L = '0'))) then
                trigger_tL2 <= '0';
            end if;
            
            
            q_prime <= q_enf;
        end if;
    end process;


end architecture;
